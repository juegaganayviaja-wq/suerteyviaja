<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gana y Viaja</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>üéâ Gana y Viaja</h1>
      <p>Elige 2 o m√°s n√∫meros y participa en el sorteo</p>
    </header>

    <form id="participacionForm">
      <div class="form-group">
        <label for="nombre">Nombre completo *</label>
        <input type="text" id="nombre" required />
      </div>

      <div class="form-group">
        <label for="telefono">Tel√©fono *</label>
        <input type="tel" id="telefono" required />
      </div>

      <div class="form-group">
        <label for="correo">Correo electr√≥nico *</label>
        <input type="email" id="correo" required />
      </div>

      <div class="form-group">
        <label for="numeros">N√∫meros (m√≠nimo 2) *</label>
        <input type="text" id="numeros" placeholder="Ej: 5, 12, 23" required />
        <small>Separados por comas</small>
      </div>

      <div class="form-group">
        <label for="referencia">Referencia de pago *</label>
        <input type="text" id="referencia" required />
      </div>

      <div class="form-group">
        <label for="fecha">Fecha de pago *</label>
        <input type="date" id="fecha" required />
      </div>

      <button type="submit">Enviar participaci√≥n</button>
    </form>

    <div id="mensaje"></div>
  </div>

  <script>
    document.getElementById('participacionForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Obtener valores
      const nombre = document.getElementById('nombre').value.trim();
      const telefono = document.getElementById('telefono').value.trim();
      const correo = document.getElementById('correo').value.trim();
      const numerosStr = document.getElementById('numeros').value.trim();
      const referencia = document.getElementById('referencia').value.trim();
      const fecha = document.getElementById('fecha').value;

      // Validar n√∫meros
      const numeros = numerosStr.split(',').map(n => n.trim()).filter(n => n);
      if (numeros.length < 2) {
        mostrarMensaje('‚ö†Ô∏è Debes ingresar al menos 2 n√∫meros.', 'error');
        return;
      }

      // Validar que sean n√∫meros
      if (!numeros.every(n => /^\d+$/.test(n))) {
        mostrarMensaje('‚ö†Ô∏è Los n√∫meros deben ser enteros positivos.', 'error');
        return;
      }

      // Preparar datos
      const datos = {
        nombre,
        telefono,
        correo,
        numeros: numeros.map(Number),
        referencia,
        fecha,
        timestamp: Date.now()
      };

      try {
        const respuesta = await fetch('https://viajaydisfruta.onrender.com/api/reservar', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(datos)
        });

        const resultado = await respuesta.json();

        if (respuesta.ok) {
          mostrarMensaje('‚úÖ ¬°Participaci√≥n registrada! Revisa tu correo.', 'exito');
          document.getElementById('participacionForm').reset();
        } else {
          mostrarMensaje(`‚ùå Error: ${resultado.error || 'No se pudo registrar'}`, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        mostrarMensaje('‚ùå Error de conexi√≥n. Intenta m√°s tarde.', 'error');
      }
    });

    function mostrarMensaje(texto, tipo) {
      const mensaje = document.getElementById('mensaje');
      mensaje.textContent = texto;
      mensaje.className = tipo;
      mensaje.style.display = 'block';
      
      // Ocultar despu√©s de 5 segundos
      setTimeout(() => {
        mensaje.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>